<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      IFT6758 Blog &middot; A template based on the Lanyon Jekyll theme
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A reserved <a href="https://jekyllrb.com" target="_blank">Jekyll</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    

    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">IFT6758 Blog</a>
            <small>A template based on the Lanyon Jekyll theme</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2022/11/09/Milestone2/">
        Milestone 2
      </a>
    </h1>

    <span class="post-date">09 Nov 2022</span>

    <h2 id="task-2---feature-engineering-i"><strong>Task 2 - Feature Engineering I</strong></h2>

<h3 id="question-1">Question 1</h3>

<p>From the tidied dataset with information of all shots and goals, we added several features: “shot distance”, “shot angle”, “is goal” and “empty net”.</p>

<p>With these information, we could plot the following figures:</p>

<p><strong>Shot counts by distance</strong></p>

<p><img src="/assets/images/milestone2_q2_1_shot_by_distance.PNG" alt="shot counts by distance" /></p>

<p>According to the above figure, it is obvious that most shots and goals were taken from distance 5 to 70 ft, which is intuitive and reasonable. The highest number of shots and goals were at distance around 15 ft, while there were just a few shots were taken at the defensive side of each team (greater than 100 ft).</p>

<p><strong>Shot counts by angle</strong></p>

<p><img src="/assets/images/milestone2_q2_1_shot_by_angle.PNG" alt="shot counts by angle" /></p>

<p>The histogram of shot counts binned by shot angle indicates that hockey shooters prefer front shots (with angle from 0 to 45 degree) than shots from the two sides with too large angle. It is understandable because if a shot is taken with a very large angle, it would easier to miss.</p>

<p>It should be noticed that there were several shots with angle greater than 90 degree. This mean the hockey players took the shots from behind the net, which is very impressive!</p>

<p><strong>Shot by both distance and angle from the net</strong></p>

<p><img src="/assets/images/milestone2_q2_1_shot_by_distance_and_angle.PNG" alt="shot distance and angle" /></p>

<p>By combining both the feature shot distance and shot angle, we realize that:</p>

<ul>
  <li>All shots from angle greater than 90 degree are taken near the net. It is obivous because the maximum distance behind the net is just around 25 ft. However, it partly proves that our feature engineering process has been done suitably.</li>
  <li>All far-distance shots were taken at angle 0 to 25 degree. This does make sense because if a hockey player shots too near from the net with very high angle, the shot would highly likely hit the goal post.</li>
</ul>

<h3 id="question-2">Question 2</h3>

<p>In this part, we figure out the relation between goal rate and the two features shot distance and shot angle.</p>

<p><img src="/assets/images/milestone2_q2_2_goal_rate_by_distance.PNG" alt="goal rate by distance" /></p>

<p><img src="/assets/images/milestone2_q2_2_goal_rate_by_angle.PNG" alt="goal rate by angle" /></p>

<ul>
  <li>The first figure shows that the closer the shot, the higher percentage it would become a goal. However, shots which are further than 160 ft have significantly higher goal rate than those from 40 to 80 ft, which is not very reasonable. It might because there were just a few shots taken from these very far distances, thus making the far-distance figures no more reliable.</li>
  <li>The second figure also implies the issues of using goal rate to evaluate hockey shots. For example, there is only one shot with angle 100 degree, and it was actually a goal. This makes the goal rate of the 100-degree shot reaches 100%, which does not make sense at all. From my point of views, we could weight the goal rate by a coefficient which is inversely proportional to shot counts to make the “goal rate” feature more useful.</li>
</ul>

<h3 id="question-3">Question 3</h3>

<p>In this question, we try to discover potential issues which could occur in this dataset.</p>

<p>Specifically, we intuitively know that <strong>it is incredibly rare to score a non-empty net goal on the opposing team from within your defensive zone</strong>. Therefore, we plots figures of shot taken with empty net and non-empty net to confirm our expectation. If there were far-distance shots taken with non-empty net, we would try to find out the reasons.</p>

<p><img src="/assets/images/milestone2_q2_3_goal_non_empty_net_by_distance.PNG" alt="goal non empty net" /></p>

<p>The above figures do show that there were shots as we described (150 to 170 ft with non-empty net).</p>

<p>We investigate the processed dataset and realized there are wrong data indeed!</p>

<p><img src="/assets/images/milestone2_q2_3_wrong_coordinates.PNG" alt="wrong coordinates dataframe" /></p>

<p><img src="/assets/images/milestone2_q2_3_wrong_coordinates_game.PNG" alt="wrong coordinates video" /></p>

<p>For instance, the shot at 01:24 (period 1) of the game between TBL and NYI (2020-09-10) has been recorded with wrong coordinates.</p>

<p>The dataframe shows that the shot was taken with coordinates [81, 2], while the net side being shot is on the left side, which is [-89, 0].</p>

<p>This makes the calculated shot distance wrong (170 ft), while the actual distance is very close to the net (as showing in the capture of the game that we took from the game’s recorded video). In fact, the actual coordinates were [-81, -2] instead.</p>

<p>We also investigate other similar shots and confirm that the recorded coordinates are wrong for all of those cases.</p>

<h2 id="task-3---baseline-models"><strong>Task 3 - Baseline Models</strong></h2>

<p>In this task, we consider simple models to learn a goal, a binary classification problem. The model will predict if a goal is achieved based on different features. Labels for goals is classified as “False” (non-goal) or “True” (goal). If it predicts a goal, (resp. non-goal) correctly, it will be a True Positive -TP (resp. True Negative - TN). If a goal is classified by a non-goal label, it is called False Negative - FN, otherwise, False Postive -FP.</p>

<p>The performance of the model can be explained partially by the accuracy score, defined as the ratio (TP+TN)/(TP+FP+TN+FN), as well as, the confusion matrix.</p>

<p>Supervised machine learning technique used in this task will be the well-know Logistic Regression (Log-Reg). We will compare the performance of Log-Res with the trival non-learning predictions based on the uniform distribution. Two individual features and a combination of them will be feed to the model.</p>

<p>The traning size is 230999.</p>

<h3 id="question-1-1">Question 1</h3>

<p>We train the model by the Log-Res from samples (x_i, y_i) where x_i is the shot distance and y_i is the goal, that belongs to {0, 1} (or {False, True}).
The accuracy of this model is recorded at 90.51%, which means, the model can predict correctly 90.51% the goal rates. However, when coming to the f1-score, that represents the median of the recall and precision, it is 0% and the reason, we observed from the confusion matrix:
TP = 69689, FP = 7311, FN = 0, TN= 0, is that, the model seems to predict positive (True or Goal) all along.</p>

<h3 id="question-2-1">Question 2</h3>

<p>As per the guideline of the assignment, we are not including the plots here. Please check the next question where we have included all the figures.</p>

<h3 id="question-3-1">Question 3</h3>

<p>We now train the model by the Log-Res from samples (x_i, y_i) where x_i is the shot angle, and x_i =(shot distance, shot angle).
We observed the same phenomena with the accuracy and f1-score.</p>

<p>We briefly conclude that the logistic regression model always predicts Goals and the features involved did not make any difference. It suggests that more advanced model must be considered for this binary classfication problem which will be explored in the Tasks 5 and 6. We even compare the Log-Reg with the non-learning statistical technique.</p>

<p>Plots for Logistic Regression Baseline with Distance only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q3_2_AUC ROC  curve Log-Reg-Distance.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Goal versus Shot Probability Model Percentile Log-Reg-Distance.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Cumulative Proportion of Goals Log-Reg-Distance.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Caliberative Curve Log-Reg-Distance.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q3_2_AUC ROC  curve Log-Reg-Angle.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Goal versus Shot Probability Model Percentile Log-Reg-Angle.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Cumulative Proportion of Goals Log-Reg-Angle.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Caliberative Curve Log-Reg-Angle.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Distance and Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q3_2_AUC ROC  curve Log-Reg-Distance&amp;Angle.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Goal versus Shot Probability Model Percentile Log-Reg-Distance&amp;Angle.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Cumulative Proportion of Goals Log-Reg-Distance&amp;Angle.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Caliberative Curve Log-Reg-Distance&amp;Angle.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Uniform Distribution are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q3_2_AUC ROC  curve UniformDist.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Goal versus Shot Probability Model Percentile UniformDist.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Cumulative Proportion of Goals UniformDist.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q3_2_Caliberative Curve UniformDist.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>The above plots depicted the results with the findings as it is obvious that the most successful model is the one combining both the distance and angle features. This model creates the most segmentation on our validation set. This model was one of the model out of the three that is able to predict the highest probability of goal for a shot. This model maximised the ROC AUC score under the curve out of the ones tested here.</p>

<p>The angle model on its own had some difficulty predicting goals. This is likely due to the fact that shots with high angle can be good depending on how far away the shot is, but low angle shots should produce the most scoring opportunities. Our model being unable to access the distance feature, it has difficulty making a sense of the angle feature.</p>

<p>The distance model on it own was performed as a reasonable model, but we see that adding the angle feature helps increase the model’s generalization.</p>

<h2 id="task-4---feature-engineering-ii"><strong>Task 4 - Feature Engineering II</strong></h2>

<p>For this task, we adjust the tidy data task from the previous milestone to add more necessary features and expect better performance of ML algorithms.</p>

<p>Specifically, the additional features are presented in the below table:</p>

<table>
  <thead>
    <tr>
      <th>Column Name</th>
      <th>Description and Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>game time</td>
      <td>The time (in seconds) when the shot was taken</td>
    </tr>
    <tr>
      <td>period</td>
      <td>The period in which the shot was taken</td>
    </tr>
    <tr>
      <td>x shot</td>
      <td>x-coordinate of the shot</td>
    </tr>
    <tr>
      <td>y shot</td>
      <td>y-coordinate of the shot</td>
    </tr>
    <tr>
      <td>shot distance</td>
      <td>Distance of the shot from the net</td>
    </tr>
    <tr>
      <td>shot angle</td>
      <td>The angle (in degree) from the net to the shot</td>
    </tr>
    <tr>
      <td>empty net</td>
      <td>A boolean variable indicating whether the net was being empty when the shot was taken</td>
    </tr>
    <tr>
      <td>x last event</td>
      <td>x-coordinate of the previous event</td>
    </tr>
    <tr>
      <td>y last event</td>
      <td>y-coordinate of the previous event</td>
    </tr>
    <tr>
      <td>time from last event</td>
      <td>Time distance between the current shot and the previous event</td>
    </tr>
    <tr>
      <td>disance from last event</td>
      <td>Distance (in feet) between the current shot and the previous event coordinates</td>
    </tr>
    <tr>
      <td>is rebound</td>
      <td>A boolean variable indicating whether the shot is a rebound</td>
    </tr>
    <tr>
      <td>change in shot angle</td>
      <td> The change in angle between two consecutive shots (in degree). Only in case the previous event was a shot or a goal, otherwise it's 0</td>
    </tr>
    <tr>
      <td>speed</td>
      <td> Defined as the distance from the previous event, divided by the time since the previous event</td>
    </tr>
    <tr>
      <td>time power play</td>
      <td>A timer indicating how long the game was in power-play sitation</td>
    </tr>
    <tr>
      <td>num player home</td>
      <td>Number of home-team players at the time the shot was taken</td>
    </tr>
    <tr>
      <td>num player away</td>
      <td>Number of away-team players at the time the shot was taken</td>
    </tr>
  </tbody>
</table>

<p>It should be noticed that we have already correct the wrong coordinates information to obtain this final dataframe.</p>

<p>For rebound shots, we include shots whose previous event were either a shot or a <strong>blocked shot</strong> (which is a bit different from the task’s suggestion).</p>

<p>Besides, we realized that there were many cases in which two consecutive shots were taken within a very large time interval (such as 22s), which should not be counted as rebounds. Therefore, we only consider a shot is a rebound if the time distance between it and its previous shot is less than 4 seconds.</p>

<p>We provide a dataframe containing all information of the game between Winnipeg and Washington on March 12, 2018 (game ID 2017021065):</p>

<p>The <a href="https://www.comet.com/anshitasaxena/milestone-project-2/65623c06f8d44e94bc8c9214745a8417?experiment-tab=assets">dataframe could be found here</a></p>

<h2 id="task-5---advanced-models"><strong>Task 5 - Advanced Models</strong></h2>
<p>It is to note that for reproducibility purposes, we have used the seed. This will allow that wherever the code runs, it will produce same results.
As per the academic project guideline, we have trained and verified the results on the basis of following models:</p>
<ol>
  <li>Base Model - This model only uses the features = {‘distance’, ‘angle’}.</li>
  <li>More Features Model - This model uses the features = {‘game_seconds’, ‘shot_distance’, ‘shot_angle’, ‘period’, ‘x_shot’, ‘y_shot’, ‘shot_type’, ‘last_event_type’, ‘x_last_event’, ‘y_last_event’, ‘time_from_last_event’, ‘distance_from_last_event’, ‘is_rebound’, ‘change_in_shot_angle’, ‘speed’}</li>
  <li>Tuned Model - This model uses the same features as part of more features, however, we have added the hyperparameter tuning using several strategies, such as, Grid Search, Random Search, and Optuna (A powerful hyperparameter tuning framework)</li>
  <li>Feature Selection Model - This model is used for exploring the feature selection techniques using SHAP and Recursive Feature Elimination Cross Validated (RFECV). Then, the model was trained after finding the best hyperparameters using the Randomized Search CV.</li>
</ol>

<h3 id="question-1-2">Question 1</h3>
<p>The following are the four different curves:<br />
ROC/AUC <br />
Accuracy: 90.51% <br />
No Skill: ROC AUC=0.500 <br />
XGBoost: ROC AUC=0.722 <br />
Here, we can see the accuracy and the proportion of area covered is 0.722.</p>

<p>Plots are given below:</p>

<table>
  <tbody>
    <tr>
      <td>ROC AUC</td>
      <td>Goal Rate versus Shot Probability</td>
      <td>Cumulative Proportion</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_1_AUC_ROC Baseline XGBoost.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q5_1_goal_rate_versus_probability_percentile.PNG" alt="Goal Rate versus Probability Percentile" /></td>
      <td><img src="/assets/images/milestone2_q5_1_cumulative_proportion.PNG" alt="Cumulative Proportion" /></td>
    </tr>
    <tr>
      <td>Caliberative Curve (Caliberation Display)</td>
      <td>Caliberative Curve (From Estimators)</td>
      <td>Caliberative Curve (From Prediction)</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_1_caliberative_curve1.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_1_caliberative_curve2.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_1_caliberative_curve3.PNG" alt="Caliberative Curve" /></td>
    </tr>
  </tbody>
</table>

<p>For this baseline setup, we have split the dataset train and test set with train set as 80% and test set as 20%. After that, we have calculated the predictions. <br /> In comparison with the logistic regression, this model exceptionally performed.
We got the area under the curve 0.70 in logistic regression baseline model which was lower than this XGBoost model which acquired 0.722. Also, the reliability curves showed unable to hug the perfectly calibrated line much in baseline logistic regression which was not the case with this XGBoost model.<br />
As expected, the model architecture of XGB allows for a much more expressive model; this is notably reflected in the calibration curve improvements over the logistic regression.
We notice that as was showcased in Question 2 the correlation between the shot-angle and the goal probability is more noisy than the correlation between goals and distance; hence the slightly less optimal calibration of the model trained on the combination of features compared to using only distance.
Link to the comet experiment: <a href="https://www.comet.com/anshitasaxena/milestone-project-2/ad83581278f0420da0e17f1b79f5bcec?experiment-tab=images">Experiment Comet Link</a></p>

<h3 id="question-2-2">Question 2</h3>
<p>We have firstly plot the four curves without any hyperparameter tuning and with the features suggested in part 4. We realized that the AUC_ROC curve area resulted into 0.757 without any hyperparameter tuning, however, AUC_ROC got increased to 0.763 using the hyperparameter tuning.
ROC AUC Curve for model without hyperparameter tuning: <br />
ROC/AUC <br />
No Skill: ROC AUC=0.500 <br />
XGBoost: ROC AUC=0.757 <br />
<img src="/assets/images/milestone2_q5_2_AUC_ROC More Features XGBoost.PNG" alt="AUC_ROC_XGBoost_More Features_Curve" />
For hyperparameter tuning, we applied three different approaches which are Grid Search, Randomized Serch and Optuna. Optuna is the best hyperparameter tuning framework.
Written below are the parameters with the best choosen parameters using the Hyperparameter Tuning approaches:</p>
<ol>
  <li>Randomized Search:
Parameters on which the randomized search applied:
params = {
         ‘min_child_weight’: [1, 5, 10],
         ‘gamma’: [0.5, 1, 1.5, 2, 5],
         ‘subsample’: [0.6, 0.8, 1.0],
         ‘colsample_bytree’: [0.6, 0.8, 1.0],
         ‘max_depth’: [3, 4, 5]
         }</li>
</ol>

<p>Best choosen parameters from this algorithm was:
{‘subsample’: 0.8, ‘min_child_weight’: 10, ‘max_depth’: 4, ‘gamma’: 1.5, ‘colsample_bytree’: 0.6}</p>

<ol>
  <li>Grid Search:
Parameters on which the grid search was applied:
parameters = {
   ‘max_depth’: range (4, 6, 1),
   ‘n_estimators’: range(400, 700, 100),
   ‘learning_rate’: [0.02, 0.05]
 }</li>
</ol>

<p>Best choosen parameters from this algorithm was:
{‘max_depth’: 4, ‘n_estimators’: 700, ‘learning_rate’: 0.02}</p>

<ol>
  <li>Optuna:
Parameters on which Optuna was applied:
param = {
       “verbosity”: 1,
       “objective”: “binary:logistic”,
       # maximum depth of the tree, signifies complexity of the tree.
       “max_depth”: trial.suggest_int(“max_depth”, 3, 27, step=2),
       # minimum child weight, larger the term more conservative the tree.
       “min_child_weight”: trial.suggest_int(“min_child_weight”, 2, 26),
       # Learning Rate
       “eta”: trial.suggest_float(“eta”, 1e-8, 1.0, log=True),
       # n estimators
       “n_estimators”: trial.suggest_float(“n_estimators”, 100, 1200),
   }</li>
</ol>

<p>Best choosen parameters from this algorithm was:
Number of finished trials:  55
Best trial:
  Value: 0.7612592563321808
  Params:
    max_depth: 9
    min_child_weight: 18
    eta: 0.3046362037044597
    n_estimators: 289.8115917562731
Number of finished trials: 55
Best trial:
  Value: 0.7612592563321808
  Params:     n_estimators: 289.8115917562731</p>

<p>Hence, on the final tuned model, we applied the parameters:
params = {‘colsample_bytree’: 0.8, ‘gamma’: 1.5, ‘learning_rate’: 0.02,
            ‘max_depth’: 5, ‘n_estimators’: 600, ‘nthread’: 1, ‘silent’: True,
            ‘subsample’: 0.6}</p>

<p>With these parameters, we got high accuracy and higher area under ROC_AUC curve.
In comparison of the Baseline model, the tuned model performed better in the following ways:</p>
<ol>
  <li>We got higher area under ROC_AUC curve which was 0.763, which was low i.e., 0.722 in the Baseline model.</li>
  <li>Additionally, it was observed that the reliability curve hugged the ‘perfectly caliberated’ curve in the tuned model which was not the case in the base model, the XGBoost curve was deflected highly apart from the ‘Perfectly Caliberated Curve’.</li>
</ol>

<p>Below are the four curves for the Tuned Model:
ROC/AUC<br />
No Skill: ROC AUC=0.500 <br />
XGBoost: ROC AUC=0.76 <br />
Here, we can see the accuracy and the proportion of area covered is 0.76.</p>

<p>Plots are given below:</p>

<table>
  <tbody>
    <tr>
      <td>ROC AUC</td>
      <td>Goal Rate versus Shot Probability</td>
      <td>Cumulative Proportion</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_2_AUC_ROC Tuned Features XGBoost.PNG" alt="AUC_ROC_XGBoost_Tuned_Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_2_goal_rate_versus_probability_percentile.PNG" alt="Goal Rate versus Probability Percentile" /></td>
      <td><img src="/assets/images/milestone2_q5_2_cumulative_proportion.PNG" alt="Cumulative Proportion" /></td>
    </tr>
    <tr>
      <td>Caliberative Curve (Caliberation Display)</td>
      <td>Caliberative Curve (From Estimators)</td>
      <td>Caliberative Curve (From Prediction)</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_2_caliberative_curve1.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_2_caliberative_curve2.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_2_caliberative_curve3.PNG" alt="Caliberative Curve" /></td>
    </tr>
  </tbody>
</table>

<p>Link to the comet experiment: <a href="https://www.comet.com/anshitasaxena/milestone-project-2/c6487221840a43d68087999ed9d21a84?experiment-tab=images">Experiment Comet Link</a></p>

<h3 id="question-3-2">Question 3</h3>

<p>We have applied several feature selection techniques, which includes the following:</p>
<ol>
  <li>SHAP</li>
  <li>RFECV - Recursive feature elimination with cross-validation to select features. This is the wrapper method which is used extensively in industrial basis setups.</li>
</ol>

<p>1.SHAP:
Using SHAP, we plotted prediction explanation, features each contributing to push the model output from the base value (the average model output over the training dataset we passed) to the model output. Features pushing the prediction higher are shown in red, those pushing the prediction lower are in blue.
<img src="/assets/images/milestone2_q5_3_shap_waterfall.PNG" alt="Waterfall Plot" />
Next, we plotted mean absolute value of the SHAP values for each feature to get a standard bar plot.
<img src="/assets/images/milestone2_q5_3_shap_bar_plot.PNG" alt="Bar Plot" /></p>

<p>2.RFECV-
Using this method, we found the best features which were contributed towards the best accuracy of the model.
[‘onehotencoder__x0_Backhand’, ‘onehotencoder__x0_Deflected’, ‘onehotencoder__x0_Slap Shot’, ‘onehotencoder__x0_Snap Shot’, ‘onehotencoder__x0_Tip-In’, ‘onehotencoder__x0_Wrap-around’, ‘onehotencoder__x0_Wrist Shot’, ‘onehotencoder__x1_Blocked Shot’, ‘onehotencoder__x1_Faceoff’, ‘onehotencoder__x1_Giveaway’, ‘onehotencoder__x1_Hit’, ‘onehotencoder__x1_Missed Shot’, ‘onehotencoder__x1_Shot’, ‘onehotencoder__x1_Takeaway’, ‘game_seconds’, ‘shot_distance’, ‘shot_angle’, ‘period’, ‘x_shot’, ‘y_shot’, ‘x_last_event’, ‘y_last_event’, ‘time_from_last_event’, ‘distance_from_last_event’, ‘is_rebound’, ‘change_in_shot_angle’, ‘speed’]</p>

<p>In comparison of the Baseline model, this new feature selected model performed better in the following ways:</p>
<ol>
  <li>We got higher area under ROC_AUC curve 0.761, which was low i.e., 0.722 in the Baseline model.</li>
  <li>With these selected features, we got high accuracy 90.99% in this model which was lower in baseline model, i.e., 90.5%.</li>
</ol>

<p>Using the best features, the accuracy of the model improved from 90.5% to 90.99%, however, we did not found any improvization in area under the AUC ROC curve.
Below are the four curves for the Best Feature selected Model:</p>
<ol>
  <li>ROC/AUC <br />
Accuracy: 90.99 <br />
No Skill: ROC AUC=0.500 <br />
XGBoost: ROC AUC=0.76 <br /></li>
</ol>

<p>Plots are given below:</p>

<table>
  <tbody>
    <tr>
      <td>ROC AUC</td>
      <td>Goal Rate versus Shot Probability</td>
      <td>Cumulative Proportion</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_3_AUC_ROC More Features XGBoost.PNG" alt="AUC_ROC_XGBoost_Tuned_Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_3_goal_rate_versus_probability_percentile.PNG" alt="Goal Rate versus Probability Percentile" /></td>
      <td><img src="/assets/images/milestone2_q5_3_cumulative_proportion.PNG" alt="Cumulative Proportion" /></td>
    </tr>
    <tr>
      <td>Caliberative Curve (Caliberation Display)</td>
      <td>Caliberative Curve (From Estimators)</td>
      <td>Caliberative Curve (From Prediction)</td>
    </tr>
    <tr>
      <td><img src="/assets/images/milestone2_q5_3_caliberative_curve1.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_3_caliberative_curve2.PNG" alt="Caliberative Curve" /></td>
      <td><img src="/assets/images/milestone2_q5_3_caliberative_curve3.PNG" alt="Caliberative Curve" /></td>
    </tr>
  </tbody>
</table>

<p>Link to the comet experiment: <a href="https://www.comet.com/anshitasaxena/milestone-project-2/e1a74e5c03a84373bbbc51af0f968032?experiment-tab=images">Experiment Comet Link</a></p>

<p>Although there is a very minute difference between the Best Tuned model and the Best Feature Selected model, but we are selecting Best Tuned model as the best model on the basis of accuracy, area under the ROC AUC curves, reliability curves (it was observed that for most of the data points, it was hugging the perfectly caliberated line and the shot goal rate probability reaches maximum using model probability).</p>

<h2 id="task-6---give-it-the-best-shot"><strong>Task 6 - Give It the Best Shot!</strong></h2>

<h3 id="question-1-3">Question 1</h3>
<p>We have tried four models for this use case:</p>
<ol>
  <li>Neural Networks</li>
  <li>Light GBM</li>
  <li>Decision Trees</li>
  <li>Random Forest</li>
</ol>

<p>For feature selection, we tried the below four approaches:</p>
<ol>
  <li>RFE- Recursive Feature Elimination. This is the wrapper method, which is widely used in industries. We selected the top 25 features via this methodology:
[‘onehotencoder__x0_Slap Shot’,’onehotencoder__x0_Wrist Shot’, ‘onehotencoder__x1_Faceoff’, ‘onehotencoder__x1_Hit’, ‘season’, ‘period’, ‘game_id’, ‘x_shot’, ‘y_shot’, ‘empty_net’, ‘home_goal’, ‘away_goal’, ‘is_rebound’, ‘game_seconds’, ‘x_last_event’, ‘y_last_event’, ‘time_from_last_event’, ‘num_player_home’, ‘num_player_away’, ‘time_power_play’, ‘shot_distance’, ‘shot_angle’, ‘change_in_shot_angle’, ‘distance_from_last_event’, ‘speed’]</li>
  <li>WOE - Feature selection via Weight of Evidence Technique. This method provided us the most important feature which should lie in the range of 0.3 to 0.5.
We found shot_distance feature as the most important feature.</li>
  <li>SelectKBest - With this method, we got the following top 25 features: [‘onehotencoder__x0_Slap Shot’, ‘onehotencoder__x0_Tip-In’, ‘onehotencoder__x0_Wrist Shot’, ‘onehotencoder__x1_Faceoff’, ‘onehotencoder__x1_Hit’, ‘onehotencoder__x1_Shot’, ‘season’, ‘period’, ‘x_shot’, ‘y_shot’, ‘empty_net’, ‘home_goal’, ‘away_goal’, ‘is_rebound’, ‘game_seconds’, ‘x_last_event’, ‘y_last_event’, ‘time_from_last_event’, ‘num_player_home’, ‘num_player_away’, ‘shot_distance’, ‘shot_angle’, ‘change_in_shot_angle’, ‘distance_from_last_event’, ‘speed’]</li>
</ol>

<p>After applying the above three different approaches, we extracted the final feature list by applying the intersection on all the four attributes:
[‘onehotencoder__x0_Wrist Shot’, ‘y_last_event’, ‘x_shot’, ‘home_goal’, ‘shot_distance’, ‘distance_from_last_event’, ‘y_shot’, ‘season’, ‘game_seconds’, ‘speed’, ‘num_player_away’, ‘num_player_home’, ‘change_in_shot_angle’, ‘empty_net’, ‘shot_angle’, ‘period’, ‘time_from_last_event’, ‘x_last_event’, ‘away_goal’]</p>

<p>For data-split and training data, we have converted all the categorical columns to numerical columns first using one-hot encoding. We used the 80% training data and 20% test data. We have also used the stratify parameter during the split to make the data distribution uniform among the classes. We have also used data standardization using StandardScalar.</p>

<p>For the hyperparameter tuning, Regularization, and Novel Metrics, we applied the below strategies: <br />
<b>1.Neural Network:</b> We tried the hyperparameter tuning using Optuna. Regularization techniques we have used the l2 regularization and Dropouts where it was observed that the performance of the model did not improved.<br /> We have compared the performance of the network using Accuracy and Loss Curves. Once the performance was achieved, we plotted the four curves and found that the area under the curve improved significantly from 0.76 to 0.83.<br /> We have also experienced the fact that without performing the feature selection techniques the accuracy and loss got stuck at a point which when we extracted features using the feature selection technique, it showed that the network started learning. We have also made sure by using BatchNormalization that at every input layer of neural network, the normalized inputs will be passed.<br />
We found the accuracy achieved using this method was 91.4% on validation set and AUC ROC was 0.832</p>

<p>Figures that shows the accuracy and loss stuck at a point:</p>

<table>
  <thead>
    <tr>
      <th>Observations</th>
      <th>Accuracy</th>
      <th>Loss</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Accuracy and Loss Stuck</td>
      <td><img src="/assets/images/milestone2_q6_1_Accuracy Stuck 8-8, 05-0.5, acc 1.jpg" alt="Accuracy Stuck" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Loss Stuck 8-8, 05-0.5, acc 1_.jpg" alt="Loss Stuck" /></td>
    </tr>
    <tr>
      <td>Tuned Accuracy and Loss</td>
      <td><img src="/assets/images/milestone2_q6_1_Accuracy Curve Neural Network.png" alt="Accuracy" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Loss Curve Neural Network.png" alt="Loss" /></td>
    </tr>
  </tbody>
</table>

<p>Plots are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve (Caliberation Display)</th>
      <th>Caliberative Curve (From Predictions)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q6_1_AUC_ROC Neural Network.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Goal Rate versus Shot Probability Model Percentile Neural Network.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Cumulative Shot Probability Neural Network.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 1 Neural Network.png" alt="Caliberation Curve1" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 2 Neural Network.png" alt="Caliberation Curve2" /></td>
    </tr>
  </tbody>
</table>

<p><b>2.Light GBM:</b> We tried the hyperparameter tuning using RandomizedSearchCV technique. For regularization purposes, we have used the reg_alpha (L1 regularization) and reg_lambda (L2 regularization), both of these regularization parameters also tuned in the hyperparameter tuning.
We passed the parameters = {‘min_gain_to_split’:[0.1, 0.3, 0.5, 0.6],”reg_alpha” :[0.4, 1], “reg_lambda” : [0.7, 1]} and found the best parameters = {‘reg_lambda’: 1, ‘reg_alpha’: 0.4, ‘min_gain_to_split’: 0.1}. We have plotted confusion matrix, classification report and feature importance graph.<br />
We found the accuracy achieved using this method was 89.90% on validation set and AUC_ROC was 0.847
Novel Metrics:</p>

<table>
  <thead>
    <tr>
      <th>Confusion Matrix</th>
      <th>Feature Importances</th>
      <th>Classification Report</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q6_1_Confusion_Matrix Light GBM.png" alt="Confusion Matrix" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Bar Plot Light GBM.png" alt="Feature Importances" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Train and Test Classification Report Light GBM.png" alt="Classification Report" /></td>
    </tr>
  </tbody>
</table>

<p>Plots are given below:</p>

<table>
  <thead>
    <tr>
      <th>ROC AUC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve (Caliberation Display)</th>
      <th>Caliberative Curve (From Estimators)</th>
      <th>Caliberative Curve (From Prediction)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q6_1_ROC_AUC Light GBM.png" alt="ROC AUC" width="1500" height="80" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Goal versus Shot Probability Model Percentile Light GBM.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Cumulative Proportion of Goals Light GBM.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 1 Light GBM.png" alt="Caliberation Curve1" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 2 Light GBM.png" alt="Caliberation Curve2" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 3 Light GBM.png" alt="Caliberation Curve3" /></td>
    </tr>
  </tbody>
</table>

<p><b>3.Random Forest:</b> We tried the hyperparameter tuning using RandomizedSearchCV technique. We tried to find various optimized parameters for this algorithm by using tree pruning via ‘criterion’, ‘min_samples_leaf’, ‘max_depth’.
We passed the parameters = {‘bootstrap’: [True, False], ‘criterion’: [‘gini’, ‘entropy’], ‘max_depth’: [2, 4, 6, 8, 16], ‘max_features’: [‘auto’, ‘sqrt’,’log2’], ‘min_samples_leaf’: [1, 2, 3, 5], ‘min_samples_split’: [2, 5, 10], ‘n_estimators’: [50, 100, 200, 500]} and found the best parameters = {‘n_estimators’: 200, ‘min_samples_split’: 10, ‘min_samples_leaf’: 5, ‘max_features’: ‘log2’, ‘max_depth’: 8, ‘criterion’: ‘entropy’, ‘bootstrap’: True}.<br />
We found the accuracy achieved using this method was 91.34% on validation set and AUC_ROC was 0.827</p>

<p>Plots are given below:</p>

<table>
  <thead>
    <tr>
      <th>ROC AUC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve (Caliberation Display)</th>
      <th>Caliberative Curve (From Estimators)</th>
      <th>Caliberative Curve (From Prediction)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q6_1_AUC ROC RandomForest.png" alt="ROC AUC" width="1500" height="80" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Goal versus Shot Probability Model Percentile RandomForest.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Cumulative Proportion of Goals RandomForest.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 1 RandomForest.png" alt="Caliberation Curve1" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 2 RandomForest.png" alt="Caliberation Curve2" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 3 RandomForest.png" alt="Caliberation Curve3" /></td>
    </tr>
  </tbody>
</table>

<p><b>4.Decision Trees:</b> We tried the hyperparameter tuning using RandomizedSearchCV technique. We tried to find various optimized parameters for this algorithm by using tree pruning via ‘criterion’, ‘min_samples_leaf’, ‘max_depth’.
We passed the parameters = {‘criterion’: [‘gini’, ‘entropy’], ‘max_depth’: [5, 7, 14, 21, 28, 35, 42], ‘min_samples_leaf’: [1, 2, 3, 5]} and found the best parameters = {‘min_samples_leaf’: 2, ‘max_depth’: 7, ‘criterion’: ‘gini’}.<br />
We found the accuracy achieved using this method was 91.48% on validation set and AUC_ROC was 0.798</p>

<p>Plots are given below:</p>

<table>
  <thead>
    <tr>
      <th>ROC AUC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve (Caliberation Display)</th>
      <th>Caliberative Curve (From Estimators)</th>
      <th>Caliberative Curve (From Prediction)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/milestone2_q6_1_AUC ROC decision tree.png" alt="ROC AUC" width="1500" height="80" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Goal versus Shot Probability Model Percentile decision tree.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Cumulative Proportion of Goals decision tree.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 1 decisiontree.png" alt="Caliberation Curve1" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 2 decisiontree.png" alt="Caliberation Curve2" /></td>
      <td><img src="/assets/images/milestone2_q6_1_Caliberative Curve 3 decisiontree.png" alt="Caliberation Curve3" /></td>
    </tr>
  </tbody>
</table>

<p>We found that most reliable out of all these four models were Neural Network and Light GBM because of their accuracy, area under ROC_AUC, their goal rate probability. Hence, we tried to plot the comparison between these two models as well using the caliberation matrix.
<img src="/assets/images/milestone2_q6_1_Caliberative Curve comparison between Light GBM and Neural Network.png" alt="Caliberative Comparison Curve" /></p>

<p>Hence, this from predictions caliberation curve displays that for most of the data points, Neural Network is best fitted with the reliability curve. With accuracy 91.4% on validation set and AUC ROC was 0.832, we conclude Neural Network as our best model.</p>

<h3 id="question-2-3">Question 2</h3>
<p>All plots associated with all the models were displayed in the previous question part. Models with their Comet Links are given below:</p>

<table>
  <thead>
    <tr>
      <th>Models</th>
      <th>Comet Links</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Neural Networks</td>
      <td><a href="https://www.comet.com/anshitasaxena/milestone-project-2/2293637ebf3241f2af343b27d683c694?experiment-tab=images">Neural Network Experiment Comet Link</a></td>
    </tr>
    <tr>
      <td>Light GBM</td>
      <td><a href="https://www.comet.com/anshitasaxena/milestone-project-2/87a4c37a5adc49c19962861cf41a5507?experiment-tab=images">Light GBM Experiment Comet Link</a></td>
    </tr>
    <tr>
      <td>Random Forest</td>
      <td><a href="https://www.comet.com/anshitasaxena/milestone-project-2/bbf64965ddd444dbba743b6ffcb469f0?experiment-tab=images">Random Forest Experiment Comet Link</a></td>
    </tr>
    <tr>
      <td>Decision Trees</td>
      <td><a href="https://www.comet.com/anshitasaxena/milestone-project-2/b5cb4a4c034d40648f58f13a47ec7cef?experiment-tab=images">Decision Trees Experiment Comet Link</a></td>
    </tr>
  </tbody>
</table>

<h2 id="task-7---evaluate-on-test-set"><strong>Task 7 - Evaluate on Test Set</strong></h2>

<h3 id="question-1-4">Question 1</h3>
<p>Being tested on the regular 2020 season: logistic regression is not performing better on the testing data, with the accuracy of 90.11% and a bias in predicting “GOAL”. XBoots has the same accuracy of 90.37%. The best model is still NN. In fact, all our models seem to be performing as good as on the validation set which is a good sign that our chosen models are robust to overfitting the data it’s trained on.</p>

<p>Plots for Logistic Regression Baseline with Distance only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_1_Receiver Operating Characteristic Log-Reg-Distance (1).png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile Log-Reg-Distance.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_1_Cumulative Proportion of Goals Log-Reg-Distance.png" alt="Cumulative Proportion" />.png)</td>
      <td><img src="/assets/images/Q7_1_Caliberative Curve Log-Reg-Distance.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_1_Receiver Operating Characteristic Log-Reg-Angle.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile Log-Reg-Angle.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_1_Cumulative Proportion of Goals Log-Reg-Angle.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_1_Caliberative Curve Log-Reg-Angle.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Distance and Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_1_Receiver Operating Characteristic Log-Reg-Distance&amp;Angle.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile Log-Reg-Distance&amp;Angle.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_1_Cumulative Proportion of Goals Log-Reg-Distance&amp;Angle.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_1_Caliberative Curve Log-Reg-Distance&amp;Angle.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Tuned XBoots only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_1_Receiver Operating Characteristic tune xgboost.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile tune xgboost.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_1_Cumulative Proportion of Goals tune xgboost.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_1_Caliberative Curve tune xgboost.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for NN only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_1_Receiver Operating Characteristic Neural Network-best_shot_model.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile Neural Network-best_shot_model.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_1_Cumulative Proportion of Goals Neural Network-best_shot_model.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_1_Goal versus Shot Probability Model Percentile Neural Network-best_shot_model.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<h3 id="question-2-4">Question 2</h3>

<p>On the playoff data for 2020 season: we observed that the NN still performs better while being tested. Even the logistic regresion has a higher accuracy of 91.44% in comparison with XBoost (73.97%), which is the worse candidate in this testing data, it is still predicting “GOAL” all along.</p>

<p>Plots for Logistic Regression Baseline with Distance only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_2_Receiver Operating Characteristic Log-Reg-Distance.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile Log-Reg-Distance.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_2_Cumulative Proportion of Goals Log-Reg-Distance.png" alt="Cumulative Proportion" />.png)</td>
      <td><img src="/assets/images/Q7_2_Caliberative Curve Log-Reg-Distance.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_2_Receiver Operating Characteristic Log-Reg-Angle.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile Log-Reg-Angle.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_2_Cumulative Proportion of Goals Log-Reg-Angle.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_2_Caliberative Curve Log-Reg-Angle.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Logistic Regression Baseline with Distance and Angle only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_2_Receiver Operating Characteristic Log-Reg-Distance&amp;Angel.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile Log-Reg-Distance&amp;Angel.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_2_Cumulative Proportion of Goals Log-Reg-Distance&amp;Angel.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_2_Caliberative Curve Log-Reg-Distance&amp;Angel.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for Tuned XBoots only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_2_Receiver Operating Characteristic tune xgboost.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile tune xgboost.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_2_Cumulative Proportion of Goals tune xgboost.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_2_Caliberative Curve tune xgboost.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>Plots for NN only are given below:</p>

<table>
  <thead>
    <tr>
      <th>AUC_ROC</th>
      <th>Goal Rate versus Shot Probability</th>
      <th>Cumulative Proportion</th>
      <th>Caliberative Curve</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/Q7_2_Receiver Operating Characteristic Neural Network-best_shot_model.png" alt="ROC AUC" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile Neural Network-best_shot_model.png" alt="Goal and Shot Probability" /></td>
      <td><img src="/assets/images/Q7_2_Cumulative Proportion of Goals Neural Network-best_shot_model.png" alt="Cumulative Proportion" /></td>
      <td><img src="/assets/images/Q7_2_Goal versus Shot Probability Model Percentile Neural Network-best_shot_model.png" alt="Caliberation Curve1" /></td>
    </tr>
  </tbody>
</table>

<p>By looking at results from playoffs, we see that the results have a higher variability. This can be explained by multiple factors:</p>
<ol>
  <li>Playoffs are a smaller subset of data than a regular season which will cause more unstable results.</li>
  <li>COVID had just hit and players got a prolonged break before playoffs which might have impacted performance.</li>
  <li>Playoff hockey is inherently different than regular season hockey. Players are more invested in the result of every single games and facing the same team multiple times in a row leave time for the teams to optimise their gameplay for their specific opponent. Furthermore, only the better teams are playing and advancing which often have better goalies making it harder for shooters to score.</li>
</ol>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2022/10/16/Milestone1/">
        Milestone 1
      </a>
    </h1>

    <span class="post-date">16 Oct 2022</span>

    <h3 id="task-1---data-acquisition">Task 1 - Data Acquisition</h3>

<p><strong>Download NHL Data</strong></p>

<p>In this section, we will build a function named “download_raw_data” to download all NHL data according to a target season/ year and a “dir_path”.</p>

<p>For example, if you want to download all NHL data in season 2018 to the directory “/data/raw”, you could run the function:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">download_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="s">"raw"</span><span class="p">)</span>
<span class="n">download_raw_data</span><span class="p">(</span><span class="s">'2018'</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>
</code></pre></div></div>

<p>It is noticed that there are two types of game, which are regular and playoff games. Therefore, the structure of directories for downloaded data will look like:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">--</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">raw</span>
    <span class="o">--</span> <span class="mi">2016</span>
    <span class="o">--</span> <span class="mi">2017</span>
    <span class="o">--</span> <span class="mi">2018</span>
        <span class="o">--</span> <span class="n">playoff_games</span>
            <span class="o">--</span> <span class="p">[</span><span class="n">gameId1</span><span class="p">].</span><span class="n">json</span>
            <span class="o">--</span> <span class="p">[</span><span class="n">gameId2</span><span class="p">].</span><span class="n">json</span>
        <span class="o">--</span> <span class="n">regular_games</span>
            <span class="o">--</span> <span class="p">[</span><span class="n">gameId3</span><span class="p">].</span><span class="n">json</span>
            <span class="o">--</span> <span class="p">[</span><span class="n">gameId4</span><span class="p">].</span><span class="n">json</span>
    <span class="o">--</span> <span class="mi">2019</span>
    <span class="o">--</span> <span class="mi">2020</span>
</code></pre></div></div>

<p>NHL data can be downloaded from the endpoint of the API: https://statsapi.web.nhl.com/api/v1/game/[GAME_ID]/feed/live/.</p>

<p>GAME_ID contains 10 digits in total, in which the first 4 digits indicate the season of the game (e.g., 2018), while the next 2 digits indicate the game’s type (01 = preseason, 02 = regular season, 03 = playoffs, 04 = all-star). The final 4 digits identify a specific game in the season. For regular games, this ranges from 0001 to 1271 (for seasons with 31 teams) or to 1230 (for those which have 30 teams). For playoff games, the last 3 digits account for round, matchup and game number respectively.</p>

<p>Now, let’s jump into how to build our data loader function!</p>

<p>Firstly, we define the function with two arguments “target_year” and “dir_path”.</p>

<p>Because NHL data is limited to five years from 2016 to 2020, we require users to enter only suitable target years.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">download_raw_data</span><span class="p">(</span><span class="n">target_year</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">):</span>
    <span class="s">"""
    Download data of all games in a specific year
    :param target_year: The year that we want to get data
    :param dir_path: Path to the directory we want to store data (not including year)
    :return: none
    """</span>
    <span class="c1"># Common variables and processing
</span>    <span class="n">available_years</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2016'</span><span class="p">,</span> <span class="s">'2017'</span><span class="p">,</span> <span class="s">'2018'</span><span class="p">,</span> <span class="s">'2019'</span><span class="p">,</span> <span class="s">'2020'</span><span class="p">]</span>

    <span class="k">if</span><span class="p">(</span><span class="n">target_year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Dataset does not contain the entered year"</span><span class="p">)</span>
        <span class="k">return</span>
</code></pre></div></div>

<p>After confirming the desirable target year is valid, we declare the structure of directory paths based on the provided arguments. Necessary directories are initialized if they are not exist.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Declare dir path
</span>    <span class="n">regular_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">target_year</span><span class="p">,</span> <span class="s">'regular_games'</span><span class="p">)</span>
    <span class="n">playoff_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">target_year</span><span class="p">,</span> <span class="s">'playoff_games'</span><span class="p">)</span>

    <span class="c1"># Create dir if it does not exist
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">regular_dir_path</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">regular_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">playoff_dir_path</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">playoff_dir_path</span><span class="p">)</span>
</code></pre></div></div>

<p>Then, we download data of all REGULAR games within the target season. From season 2017 to 2020, there were 31 teams with 1271 games in each season. However, only 30 teams involved in season 2016, therefore the total number of games is 1230 in that year.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Download data of regular games
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Starting download data for regular games of season "</span><span class="o">+</span><span class="n">target_year</span><span class="p">)</span>

    <span class="c1"># Season 2016 has 1230 games, while the rest have 1271
</span>    <span class="n">ID_range</span> <span class="o">=</span> <span class="mi">1230</span> <span class="k">if</span> <span class="p">(</span><span class="n">target_year</span><span class="o">==</span><span class="s">'2016'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1271</span>

    <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ID_range</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
        <span class="c1"># Convert ID from integer to string
</span>        <span class="n">ID_str</span> <span class="o">=</span>  <span class="s">"0"</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ID</span><span class="p">)))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">regular_game_id</span> <span class="o">=</span> <span class="n">target_year</span><span class="o">+</span><span class="s">"02"</span><span class="o">+</span><span class="n">ID_str</span>

        <span class="c1"># Download data of each game
</span>        <span class="n">download_game_data</span><span class="p">(</span><span class="n">regular_dir_path</span><span class="p">,</span> <span class="n">regular_game_id</span><span class="p">)</span>
</code></pre></div></div>

<p>Similarly, data of playoff games are downloaded based on its game ID. It is noticed that there are 4 playoff rounds for each season. The first round starts with 8 matchups, then the number of matchups is halved for each following round (round 2: 4 matchups, round 3: 2 matchups and the final round has 1 matchup). Besides, each matchup includes 7 games in total.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Download data of playoff games
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Starting download data for playoff games of season "</span><span class="o">+</span><span class="n">target_year</span><span class="p">)</span>

    <span class="c1"># There are 4 rounds in total
</span>    <span class="k">for</span> <span class="n">round_number</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
        <span class="c1"># round 1 has 8 matchups, round 2 has 4 matchups and so on
</span>        <span class="n">number_of_matchups</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">round_number</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">matchup_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_matchups</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Each match up has 7 games in total
</span>            <span class="k">for</span> <span class="n">game_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                <span class="n">playoff_game_id</span> <span class="o">=</span> <span class="n">target_year</span><span class="o">+</span><span class="s">"030"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">round_number</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">matchup_number</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">game_number</span><span class="p">)</span>
                <span class="n">download_game_data</span><span class="p">(</span><span class="n">playoff_dir_path</span><span class="p">,</span> <span class="n">playoff_game_id</span><span class="p">)</span>
</code></pre></div></div>

<p>Here, we use a supporting function named “download_game_data”, which can download data of a specific game from the NHL API according to the provided game ID.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">download_game_data</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">game_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    Download data of a specific game into a particular dir path
    :param dir_path: Path to the dir
    :param game_id: Game id of the game that we want to download
    :return: none
    """</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">game_id</span><span class="o">+</span><span class="s">".json"</span><span class="p">)</span>

    <span class="c1"># Return if file already exists
</span>    <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)):</span>
            <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"https://statsapi.web.nhl.com/api/v1/game/"</span> <span class="o">+</span> <span class="n">game_id</span> <span class="o">+</span> <span class="s">"/feed/live/"</span><span class="p">)</span> <span class="k">as</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">"messageNumber"</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s">"message"</span> <span class="ow">in</span> <span class="n">data</span> \
                <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">"messageNumber"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">"message"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"Game data couldn't be found"</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">he</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">he</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'game_id: '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">game_id</span><span class="p">))</span>
        <span class="n">e_type</span><span class="p">,</span> <span class="n">e_value</span><span class="p">,</span> <span class="n">e_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e_value</span><span class="p">)</span>
</code></pre></div></div>

<p>Here we go! We have prepared all necessary functions to download NHL data. To collect data from all seasons (2016 to 2020) to the folder “/data/raw”, you could run the following python code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">download_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="s">"raw"</span><span class="p">)</span>
<span class="n">available_years</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2016'</span><span class="p">,</span> <span class="s">'2017'</span><span class="p">,</span> <span class="s">'2018'</span><span class="p">,</span> <span class="s">'2019'</span><span class="p">,</span> <span class="s">'2020'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">:</span>
    <span class="n">download_raw_data</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>
</code></pre></div></div>

<p>Great! All data of NHL games from 2016 to 2020 have been downloaded and arranged nicely according to the provided path.</p>

<p>You can run the code multiple times if you want to ensure all data are downloaded properly. Existed files will be skipped automatically by the function so that it will not waste your time for downloading duplicate data!</p>

<h3 id="task-2---interactive-debugging-tool">Task 2 - Interactive Debugging Tool</h3>

<p>In this step, we explore NHL data using Interactive Widgets that allow us to switch between Game Type (regular vs playoffs), between seasons as well as to flip over all games. Interactive Debugging Tool help us to understand the game data better with ease of visual notation, for each game we can visualise all the event ID’s in sequence manner. Events in each game will be graphically illustrated by the position of the corresponding event in the ice rink, with detailed description of the players involved and the shot played, printed below the image.</p>

<p><img src="/assets/images/Milestone_1_Q_2.PNG" alt="ice_rink" /></p>

<p>Code for this tool is given below:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="n">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="n">widgets</span>
<span class="kn">import</span> <span class="nn">json</span><span class="p">,</span> <span class="n">os</span>

<span class="k">def</span> <span class="nf">interactive_main</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
    <span class="s">"""
    Intractive tool main function
    :param reg: Dropdown to select regular or playoff game
    """</span>
    <span class="c1"># Path of the directory to collect the data
</span>    <span class="c1"># The data for this functionality coming from the live jsons
</span>    <span class="c1"># As per the TA recommendation, we are not keeping the data in Github but we are mentioning her the correct path
</span>    <span class="n">path</span> <span class="o">=</span> <span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()).</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'milestone1'</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">'data'</span><span class="p">,</span> <span class="s">'raw'</span><span class="p">)</span>
    <span class="n">file_path_seasons</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
    <span class="c1"># load the rink: for project use the following
</span>    <span class="n">path2rink</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()).</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s">'reports'</span><span class="p">,</span> <span class="s">'figures'</span><span class="p">,</span> <span class="s">"nhl_rink.png"</span><span class="p">)</span>
    <span class="c1"># List of all the seasons
</span>    <span class="n">all_folders</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">file_path_seasons</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_season</span><span class="p">(</span><span class="n">season</span><span class="p">):</span>
        <span class="s">"""
        Intractive tool main function
        :param reg: Dropdown to select regular or playoff game
        """</span>
        <span class="c1"># Path for the data
</span>        <span class="n">path</span> <span class="o">=</span> <span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()).</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'milestone1'</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">'data'</span><span class="p">,</span> <span class="s">'raw'</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="o">+</span><span class="s">"/"</span><span class="o">+</span><span class="n">reg</span><span class="o">+</span><span class="s">"/"</span> <span class="o">+</span> <span class="n">season</span> <span class="o">+</span><span class="s">"/"</span>
        <span class="c1"># creating list of all game_id
</span>        <span class="n">id_list</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">id_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fname</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">get_game_id</span><span class="p">(</span><span class="n">game_id</span><span class="p">):</span>
            <span class="n">g_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">game_id</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1"># Get the game id from json
</span>            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fname</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">g_id</span><span class="o">+</span><span class="s">".json"</span><span class="p">):</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">fname</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Get the associated columns of data from json
</span>            <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'gameData'</span><span class="p">][</span><span class="s">'datetime'</span><span class="p">][</span><span class="s">'dateTime'</span><span class="p">])</span>
            <span class="n">home</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'gameData'</span><span class="p">][</span><span class="s">'teams'</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'abbreviation'</span><span class="p">]</span>
            <span class="n">away</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'gameData'</span><span class="p">][</span><span class="s">'teams'</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'abbreviation'</span><span class="p">]</span>
            <span class="n">goals_home</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'plays'</span><span class="p">][</span><span class="s">'currentPlay'</span><span class="p">][</span><span class="s">'about'</span><span class="p">][</span><span class="s">'goals'</span><span class="p">][</span><span class="s">'home'</span><span class="p">]</span>
            <span class="n">goals_away</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'plays'</span><span class="p">][</span><span class="s">'currentPlay'</span><span class="p">][</span><span class="s">'about'</span><span class="p">][</span><span class="s">'goals'</span><span class="p">][</span><span class="s">'away'</span><span class="p">]</span>
            <span class="n">sog_home</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span>
            <span class="n">sog_away</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'shotsOnGoal'</span><span class="p">]</span>
            <span class="n">so_goalshome</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'shootoutInfo'</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'scores'</span><span class="p">]</span>
            <span class="n">so_attemptshome</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'shootoutInfo'</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'attempts'</span><span class="p">]</span>
            <span class="n">so_goalsaway</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'shootoutInfo'</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'scores'</span><span class="p">]</span>
            <span class="n">so_attemptsaway</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'shootoutInfo'</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'attempts'</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Game ID: "</span><span class="o">+</span> <span class="n">g_id</span> <span class="o">+</span><span class="s">";   "</span> <span class="o">+</span> <span class="n">home</span> <span class="o">+</span><span class="s">"  (home) vs "</span><span class="o">+</span> <span class="n">away</span> <span class="o">+</span> <span class="s">" (away)"</span><span class="p">)</span>
            <span class="k">print</span> <span class="p">(</span> <span class="s">"           "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s">"OT"</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"                        "</span> <span class="o">+</span> <span class="s">"Home"</span> <span class="o">+</span><span class="s">"      "</span><span class="o">+</span> <span class="s">"Away"</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"           Teams:       "</span> <span class="o">+</span> <span class="n">home</span> <span class="o">+</span><span class="s">"       "</span><span class="o">+</span> <span class="n">away</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"           Goals:       "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">goals_home</span><span class="si">}</span><span class="s">'</span> <span class="o">+</span><span class="s">"         "</span><span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">goals_away</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"           SoG:         "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">sog_home</span><span class="si">}</span><span class="s">'</span> <span class="o">+</span><span class="s">"        "</span><span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">sog_away</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"           So Goals:    "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">so_goalshome</span><span class="si">}</span><span class="s">'</span> <span class="o">+</span>  <span class="s">"         "</span><span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">so_goalsaway</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"           So Attempts: "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">so_attemptshome</span><span class="si">}</span><span class="s">'</span> <span class="o">+</span>  <span class="s">"         "</span><span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">so_attemptsaway</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

            <span class="c1"># Store the data into the variable
</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'plays'</span><span class="p">][</span><span class="s">'allPlays'</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">rink</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="c1"># Get the data of player
</span>                <span class="n">players</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Player coordinates
</span>                <span class="n">cor</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="s">'coordinates'</span><span class="p">]</span>
                <span class="c1"># If no coordinates, no information displayed
</span>                <span class="k">if</span> <span class="n">cor</span><span class="o">==</span><span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">players</span><span class="p">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Information displayed on coordinates
</span>                    <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path2rink</span><span class="p">)</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span> <span class="p">,</span><span class="o">-</span><span class="mf">42.5</span><span class="p">,</span> <span class="mf">42.5</span><span class="p">])</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="s">"result"</span><span class="p">][</span><span class="s">"description"</span><span class="p">]</span>
                    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cor</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">cor</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="s">"o"</span><span class="p">)</span>
                    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span><span class="s">'bold'</span><span class="p">)</span>
                    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">players</span><span class="p">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="c1"># Put the interactive widget for selecting the Event Id
</span>            <span class="n">widgets</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">rink</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Event ID"</span><span class="p">))</span>

        <span class="c1"># List of game id in the interactive widget
</span>        <span class="n">widgets</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">get_game_id</span><span class="p">,</span> <span class="n">game_id</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="n">id_list</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">'Game ID:'</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="c1"># List of season id in the interactive widget
</span>    <span class="n">widgets</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">get_season</span><span class="p">,</span> <span class="n">season</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">Dropdown</span><span class="p">(</span>
        <span class="n">options</span><span class="o">=</span><span class="n">all_folders</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s">'Season:'</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="c1"># List of type
</span><span class="n">widgets</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">interactive_main</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s">'regular_season'</span><span class="p">,</span> <span class="s">'playoffs'</span><span class="p">],</span>
    <span class="n">description</span><span class="o">=</span><span class="s">'Game Type:'</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="task-3---tidy-data">Task 3 - Tidy Data</h3>

<p><strong>3.1 - Raw data to dataframe</strong></p>

<p>No one wants to work with tons of raw data stored in boring json files. In this section, we will create a function to convert downloaded data into a single beautiful pandas dataframe with all necessary information of in-game events. For example:</p>

<p><img src="/assets/images/dataframe.png" alt="dataframe_example" /></p>

<p>Here, we only include events of type “shots” and “goals”. For each event, certain number of features are kept such as game time, game ID, team shot information, coordinates of the shot,…</p>

<p><strong>3.2 - Strength of players</strong></p>

<p>In several circumstances, some players could get a penalty due to fouling so that they must stop playing for a certain period of time. In such cases, the “strength” of players on the ice will change (e.g., 5 on 4, for 5 on 3, etc).</p>

<p>We can include into the dataframe the “strengh field” as followings:</p>
<ul>
  <li>Add two columns into the dataframe which indicate the number of players of each team.</li>
  <li>Set the number of players for both team to 5 at the beginning of the game.</li>
  <li>When a player in a team gets penalty, the count value of that team is substracted by 1. We get this information from the penalty events.</li>
  <li>If the penalty time is over (based on the field “penaltyMinutes” of the event) or the enemy team has a goal (event “goal” of the enemy), the subtracted count is recovered.
(https://adventure.howstuffworks.com/outdoor-activities/snow-sports/hockey2.htm)</li>
</ul>

<p>By that way, the actual strength information could be added to the dataframe for every shot/ goal event.</p>

<p><strong>3.3 - Additional features</strong></p>

<p>More information could be added into the dataframe to give us better insights about the events.</p>

<ul>
  <li>Firstly, we can calculate and add the distance of the shot to the goal. This is an useful information, partly indicating how dangerous each shot is, or showing the strategy of each team/ player. To calculate this information, we must use the following information: “coordinates” of the shot, and “rinkSide” of the team who takes the shot.</li>
  <li>Secondly, we could include the “rebound” information by taking into account the previous event of each shot. If the previous event is a “blocked shot”, this means the current shot is a rebound shot if it’s taken by the same team.</li>
  <li>Thirdly, we could add a column to count the number of penalties that each team got. This might show the strategy of each team as well as each player.</li>
</ul>

<h3 id="task-4---simple-visualization">Task 4 - Simple Visualization</h3>

<p><strong>4.1 - Shot types and their dangers</strong></p>

<p>This section compares shot types over all teams in a paricular season. The bar chart below show those information of season 2019.</p>

<p><img src="/assets/images/Milestone_1_Q_5_1.png" alt="shot_type" /></p>

<p>It is clear that Wrist shot is the most common type with about 38,000 shots and goals. In fact, wrist shot is an effective shot which is not very difficult and are commonly used at all levels of hockey (https://www.rookieroad.com/ice-hockey/what-is-a-wrist-shot/).</p>

<p>Whereas, we would argue that Tip-in is the most dangerous type of shot with 16.9% success chance. It does make sense because this shot is taken at a very close range, especially by a deflection of a shot by another player (https://www.yourdictionary.com/tip-in). Therefore, it seems very challenging for the goalies to save the goals.</p>

<p><strong>4.2 - Shot distance analysis</strong></p>

<p>This section investigates the impact of shot distance on the percentage of success. The line graphs belows illustrate that information for three different seasons from 2018 to 2020.</p>

<p><img src="/assets/images/Milestone_1_Q_5_2.png" alt="shot_distance" /></p>

<p>It is obvious that the success rate of shots within 4ft from the net is significantly higher for all three seasons compared to other distances. It makes sense for not only hockey, but also many other sports such as football.</p>

<p>The figure for shots within 75ft from the net is quite smooth, while for far-distance shots, it looks like noise. That is because the frequency of far-distance shots was very low. E.g., if there are only two shots from 180 ft away, and one of them (just luckily) turns out to be a goal, the success rate is 50%.</p>

<p>Furthermore, while the results of the two year 2018 and 2019 were quite similar to each other, season 2020 saw a significant change in success rate corresponding to shot distance. Specifically, the success rate of shots which are very close to the net (1 ft away) is only 50%, while that figure for 2018 and 2019 is nearly 100%. Whereas, far-distance shots tend to more dangerous in season 2020 according to the above figure.</p>

<p><strong>4.3 - Effects of shot types and distance on scoring percentage</strong></p>

<p><img src="/assets/images/Milestone_1_Q_5_3.png" alt="shot_type_distance" /></p>

<p>The above heat map illustrates the relationship of shot types and shot distance with the goal percentage for season 2019.</p>

<p>In general, most types of shot are more dangerous when they’re near the net (less than 30 ft). This is shown clearly with Tip-in and Wrist shot, where goal percentage decreases smoothly corresponding to shot distance within 40 ft from the net.</p>

<p>Wrap-around seems not effective regardless of shot distance since the goal percentage was very low for most distances.</p>

<p>We do not focus on far-distance shots due to its low frequency, which does not reflect well the effectiveness.</p>

<p>In conclusion, a tip-in, wrist shot or snap shot within 2 ft from the net should be the most dangerous shot. A deflected shot from 40-60 ft is also relatively dangerous in season 2019.</p>

<h3 id="task-5---advanced-visualizations-shot-maps">Task 5 - Advanced Visualizations: Shot Maps</h3>

<p><strong>5.1 - Export the 4 plot offensive zone plots to HTML</strong></p>

<p>Our team implemented it using Dash Application. We have created the application in dash and then launched it as application on top of Heroku. This dash application is fully interactive according to the seasons and teams selections by user.
Please find the link of our dash application here:</p>

<p><a href="https://advancedvisuals.herokuapp.com/">Interactive Shot Map Plot</a></p>

<p>Additionally here is our html plot:</p>

<iframe src="https://advancedvisuals.herokuapp.com/" title="Advanced Visualizations" width="990" height="620">
</iframe>

<p>Here is a little summary of our builds done on Heroku: <img src="/assets/images/heroku-apps-advancedvisuals-2022-10-23.png" alt="Heroku builds" /></p>

<p><strong>5.2 - Interpretation from these plots</strong></p>

<p>Charts with net at the top shows the offense which means the shots taken by the selected team. This map shows how many times the shot is taken as compared to the NHL average team in the same season from a specific location.
This plot is based on the three different colors: {‘red, ‘blue’, and ‘white’} which shows three different situations:</p>
<ol>
  <li>Red region denotes that the team has taken shots more league average rate.</li>
  <li>Blue region denotes that the team has taken shots less league average rate.</li>
  <li>White region denotes that the team has taken shots at league average rate.</li>
</ol>

<p>The selected team offence ability can be evaluated by studying these graphs. The more dark the red region is the more the density of shots will be traced out for the selected team. Likewise, the dark the blue region is the less the density of shots will be traced out for the selected team. White region shows the number of shots taken by the selected team at league average rate.</p>

<p><strong>5.3 - Colorado Avalanche Discussion</strong></p>

<p>In 2016-17 season, it can be interpreted by the shot map that Colorado Avalanche performed as a average team because most of the region on the rink is showing the shots taken equivalent to the league average rate. There are two regions which are worth to mention here which is the blue pattern. Blue pattern signifies that the team took the goals less than the league average rate nearer to the goal post. The red region which is located at the left side of the rink between 40 to 50 feet shows only one region at the entire rink which signifies the shots taken by the team exceeded the league average rate.
<img src="/assets/images/2016_17_Colorado_Avalanche_Team.png" alt="Colorado Avalanche1" /></p>

<p>In 2020-21 season, overall shot map depicts the best performance of the Colorado Avalanche team, which shows maximum region as red color i.e., the shots taken exceeded the league average rate mostly nearer to the goal post, center of the semi-rink and left side between 50 to 60 feets. It shows very few instances where the team took shots below the league average rate which is located at the right side of the rink between 50 to 60 feets.
<img src="/assets/images/2020_21_Colorado_Avalanche_Team.png" alt="Colorado Avalanche2" /></p>

<p>Overall, it can be concluded that the Avalanche team performed well in 2020-21 as they had maximum region at the rink which has the shots taken exceeded the league average rate in comparison to the 2016-17, where it doesn’t show that much performance on the rink. It looks reliable also as per the red and blue patterns at the rink, red contours are drawn and allocated lot of surface of rink in 2020-21, which is not the case in 2016-17.</p>

<p><strong>5.4 - Discussion on Buffalo Sabres and Tampa Bay Lightning</strong></p>

<p>By examining the plots, it is evident that Tampa Bay Lightning always follows the strategy to take the maximum shots in front of goal post on the rink. Red region which shows the shots taken beyond the league average rate is drawn in front of the goal post the all the three seasons. This was not the case with Buffalo Sabres as their red regions are drawn always in the side of the rink.</p>

<p>Moreover, Buffalo Sabres shows the darker part of the blue region and blue region is located mostly on the rink particularly for seasons 2019-20 and 2020-21 which also contributed towards their non performant. Although, plot for this team in 2018-19 shows the red region mostly but that is not located in front of the goal post which is the case for Tampa Bay Lightning which is one more additional point contributed towards non performant of the team.</p>

<p>Overall, the one of the main contributed factor towards the success behind Tampa Bay Lightning is to perform the shots exceed the league average rate taken in front of the goal post.</p>

<p>Tampa Bay Lightning Plots for Seasons 2018-19, 2019-20, 2020-21:-</p>

<p><img src="/assets/images/2018_19_Tampa_Bay_Lightning.png" alt="Tampa Bay Lightning1" />
<img src="/assets/images/2019_20_Tampa_Bay_Lightning.png" alt="Tampa Bay Lightning2" />
<img src="/assets/images/2020_21_Tampa_Bay_Lightning.png" alt="Tampa Bay Lightning3" /></p>

<p>Buffalo Sabres Plots for Seasons 2018-19, 2019-20, 2020-21:-</p>

<p><img src="/assets/images/2018_19_Buffalo_Sabres_Team.png" alt="Buffalo Sabres1" />
<img src="/assets/images/2019_20_Buffalo_Sabres_Team.png" alt="Buffalo Sabres2" />
<img src="/assets/images/2020_21_Buffalo_Sabres_Team.png" alt="Buffalo Sabres3" /></p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
